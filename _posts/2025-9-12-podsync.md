---
layout: post
title: 在Apple Podcast听Bilibili的频道
---

在VPS上用 Docker 部署 yangtfu/podsync，把 Bilibili 视频自动转成可订阅的播客（Podcast）源，并通过你自己的域名提供 RSS 订阅。

摘要
- 目标：自动抓取 Bilibili UP 主的新视频，转码为音频/视频播客，生成 RSS，供播客客户端订阅。
- 工具：yangtfu/podsync（fork 自 mxpv/podsync，增加 Bilibili 支持）、Docker、docker-compose、可选 Nginx 反向代理。
- 结果：你的播客客户端通过 http(s)://你的域名/feed/你的feed名.xml 订阅，podsync 定时更新。

一、前置条件
- 一台外网可达的 Linux VPS（Ubuntu/Debian/CentOS 均可）
- Docker 和 Docker Compose
- 一个域名（推荐，用于 HTTPS 和稳定订阅 URL）
- 基础的 Linux SSH 与编辑器使用能力

安装 Docker 和 Compose（以 Ubuntu 为例）
- 略（常规安装）。如果未安装，可参考官方教程，或使用 apt 版 compose plugin。

二、项目说明与仓库信息
- 使用版本：yangtfu/podsync（默认分支为 bilibili，Go 语言，MIT License）
- 仓库主页：https://github.com/yangtfu/podsync
- 该 fork 在原 mxpv/podsync 的基础上，增加了 Bilibili 的抓取能力。我们将基于这个版本构建 Docker 镜像和运行服务。

三、目录结构与持久化
建议在 VPS 上建立如下目录（用于持久化配置与数据）：
- /opt/podsync/
  - config/ 存放 config.toml
  - data/ 存放下载的音视频文件、元数据和缓存
  - docker-compose.yml

四、准备 docker-compose 和配置文件
下面给出最小可用并兼顾可维护的示例。你可以直接把文件复制到 VPS 对应位置。

文件 1：docker-compose.yml
- 说明：
  - 推荐直接从仓库源码构建镜像，确保使用的是带 Bilibili 支持的版本。
  - 使用 git URL 作为 build context（Compose v2 支持）。如果你的 compose 不支持 git context，改用“先 git clone 再 docker build”的方式（文末附备选方案）。
  - 将宿主的 ./config 和 ./data 挂载到容器内 /app/config 与 /app/data。
  - 服务默认监听 8080 端口，可通过 Nginx 暴露 80/443。

```yaml name=docker-compose.yml
services:
  podsync:
    container_name: podsync-bilibili
    # 方式一：直接从 Git 仓库构建（Compose v2 支持 git context）
    build:
      context: https://github.com/yangtfu/podsync.git#bilibili
      dockerfile: Dockerfile
    # 如果你想固定某个 commit，也可用：...git#bilibili:subdir@<commit-sha>

    # 方式二（二选一）：若你已经本地构建了镜像，请改为：
    # image: podsync-bilibili:latest

    restart: unless-stopped
    volumes:
      - ./config:/app/config
      - ./data:/app/data
    ports:
      - "8080:8080"
    environment:
      # 可选：设置时区，便于日志查看
      - TZ=Asia/Shanghai
      # 可选：若需要访问登录后或更高清晰度视频，可提供 B 站 Cookie（风险自担，注意隐私）
      # - BILIBILI_COOKIE=SESSDATA=xxx; bili_jct=xxx; DedeUserID=xxx
    # 可选：资源限制
    # deploy:
    #   resources:
    #     limits:
    #       cpus: '1.00'
    #       memory: 1G
```

文件 2：config.toml
- 说明：
  - server.base_url 请填写你的公网访问 URL（含协议），播客客户端会使用这个地址拼装 enclosure 链接，务必正确。
  - feeds.* 中的 url 直接填 B 站 UP 主主页（视频页）或分区/合集链接，podsync 会根据域名识别为 Bilibili。
  - format 可选 audio 或 video；quality 可选 high/medium/low（具体由实现和源站可得清晰度决定）。
  - update_period 使用 Go 的时间表达式（如 15m, 1h, 6h, 24h 等）。
  - 如需更大抓取范围可调 page_size 和 max_pages，注意频率不要过高以免触发风控。
  - 可选 tokens.bilibili_cookie 提升可访问性与清晰度（如访问某些限制内容），若已通过环境变量提供，也可不在文件中写死。

```toml name=config/config.toml
[server]
# 你的外网可访问地址，用于 RSS 里 enclosure 的绝对链接拼装
# 使用域名+https 最佳，例如：https://podcast.example.com
base_url = "http://YOUR_SERVER_IP:8080"
port = 8080
# 如果你只在容器内监听 8080，并用 Nginx 提供 80/443，这里 https 可以为 false
https = false
# 数据目录（容器内路径），需与 docker-compose 卷挂载对应
data_dir = "/app/data"
# 可选：展示名称（出现在网页/目录列表）
title = "My Bilibili Podcast Hub"

# 令牌区域（可选）
[tokens]
# 可选：提供 B 站 Cookie（注意：把敏感内容优先放到环境变量里更安全）
# bilibili_cookie = "SESSDATA=xxx; bili_jct=xxx; DedeUserID=xxx"

# 全局下载/转码参数（可选）
[downloads]
# 提取音频需要 ffmpeg（镜像一般已内置）
# 并发数、重试策略等可按需扩展（如果 fork 支持）
concurrency = 2

# 定义多个播客源
[feeds]

  # 示例 1：订阅某个 UP 主主页视频列表（把 1234567 换成真实 UID）
  [feeds.bili_uid_1234567]
  url = "https://space.bilibili.com/1234567/video"
  # 把视频转音频
  format = "audio"
  quality = "high"
  page_size = 20
  max_pages = 3
  update_period = "6h"
  # 自定义播客标题（可选）
  custom_name = "某UP主 - B站"
  # 文件名模板（可选，避免过长和非法字符）
  filename_template = "{title}"

  # 示例 2：保留为视频播客（更占空间与带宽）
  [feeds.bili_video_demo]
  url = "https://space.bilibili.com/7654321/video"
  format = "video"
  quality = "high"
  page_size = 10
  update_period = "12h"
  custom_name = "另外的UP主 - 视频播客"

  # 示例 3：指定专栏/合集/播放列表链接（按照实际链接替换）
  # [feeds.bili_collection_demo]
  # url = "https://www.bilibili.com/list/ml123456789"
  # format = "audio"
  # quality = "medium"
  # page_size = 30
  # update_period = "24h"
```

五、启动与验证
1) 启动
- 在 /opt/podsync 目录执行：
  - docker compose up -d
- 首次启动会构建镜像（若使用 build 方式），时间视 VPS 配置而定。

2) 核对日志
- docker logs -f podsync-bilibili
- 正常会看到服务启动、定时任务轮询、抓取与转码日志。

3) 访问健康页与 feed
- 打开 http://你的服务器IP:8080/ 查看首页或健康页（不同 fork 显示不同）。
- 订阅地址形如：
  - http://你的服务器IP:8080/feed/bili_uid_1234567.xml
  - http://你的服务器IP:8080/feed/bili_video_demo.xml
- 将上述 URL 添加到任意播客客户端（Apple Podcasts、Overcast、Pocket Casts、Castro、AntennaPod 等）。

六、通过 Nginx 暴露 HTTPS（可选但强烈推荐）
- 你可能希望用域名 podcast.example.com 并签发 HTTPS。
- 基础反向代理示例（配合 certbot 自动签证书更好）：

```nginx name=nginx-podsync.conf
server {
    listen 80;
    server_name podcast.example.com;

    location / {
        proxy_pass http://127.0.0.1:8080;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
```

- 之后将 config.toml 的 server.base_url 改为 https://podcast.example.com，重启容器，确保 RSS 里的 enclosure 链接是可公网访问的 HTTPS 地址。

七、运维建议与常见问题
- Bilibili 反爬与 Cookie
  - 如果抓取失败、频繁 412/403，考虑：
    - 放慢 update_period（例如 6h 以上）
    - 减小 page_size / max_pages
    - 提供有效的 BILIBILI_COOKIE（SESSDATA 等），但注意隐私与安全
  - 不要对同一源抓取过于频繁，以免账号或 IP 被限制。
- 磁盘与带宽
  - 视频播客很占空间和带宽；如只需音频，format=audio 更省资源。
  - 定期清理 data 目录旧内容，或设置对象存储/外挂盘。
- 基础 URL 一定要正确
  - server.base_url 决定 RSS 里的下载链接，若与实际暴露的域名/协议不一致，客户端无法下载。
- 备份配置
  - config/ 与 data/ 请定期备份，避免重建后丢失历史与订阅稳定性。
- 法律与合规
  - 请遵守 B 站和内容创作者的版权与使用条款，仅用于个人学习与时间移位收听，勿对外大规模传播或商用。
- 版本与更新
  - 该仓库默认分支为 bilibili。后续更新时，建议先在测试环境验证再上生产。
  - 更新步骤：docker compose pull/build -> docker compose up -d

八、如果你的 Compose 不支持 git context（备选构建方案）
- 在 VPS 上手动构建镜像：
  - cd /opt && git clone -b bilibili https://github.com/yangtfu/podsync.git
  - cd podsync
  - docker build -t podsync-bilibili:latest -f Dockerfile .
- 然后将 docker-compose.yml 改为使用 image: podsync-bilibili:latest，并删除 build 段：
  - image: podsync-bilibili:latest

九、进阶：对接你的博客/主页
- 你可以把订阅说明页写在你的个人网站（例如 pjymyth.github.io），放上订阅链接：
  - https://podcast.example.com/feed/bili_uid_1234567.xml
  - 并说明这是从 B 站转播客的个人自用服务，便于多端快速添加。

结语
以上就是在 VPS 上用 Docker 部署 yangtfu/podsync，把 Bilibili 视频转成播客 RSS 的完整流程。按文中示例，你可以很快地为常看的 UP 主生成音频/视频播客订阅源，并在播客客户端中自动追更。如果你愿意，我也可以基于你的域名与 VPS 环境定制一份可直接上线的配置。
